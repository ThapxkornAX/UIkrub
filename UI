local library = {currenttab = '', toggled = false}
local tween = game:GetService("TweenService")
local uis = game:GetService("UserInputService")
local maincolor = Color3.fromRGB(255,163,26) -- สีธีมหลัก (สีส้ม)

-- ลบ GUI เก่าออกเพื่อกันซ้อนทับ
local old = game.CoreGui:FindFirstChild('ScreenGui') 
if old then old:Destroy() end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "ScreenGui"
if syn and syn.protect_gui then 
    syn.protect_gui(ScreenGui) 
    ScreenGui.Parent = game.CoreGui 
elseif gethui then 
    ScreenGui.Parent = gethui() 
else 
    ScreenGui.Parent = game.CoreGui 
end

local function dragify(Frame)
    local dragToggle = nil
    local dragSpeed = 0.25
    local dragInput = nil
    local dragStart = nil
    local dragPos = nil
    local startPos = nil
    
    local function updateInput(input)
        local Delta = input.Position - dragStart
        local Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + Delta.X, startPos.Y.Scale, startPos.Y.Offset + Delta.Y)
        tween:Create(Frame, TweenInfo.new(dragSpeed), {Position = Position}):Play()
    end
    
    Frame.InputBegan:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch) then
            dragToggle = true
            dragStart = input.Position
            startPos = Frame.Position
            input.Changed:Connect(function()
                if (input.UserInputState == Enum.UserInputState.End) then
                    dragToggle = false
                end
            end)
        end
    end)
    
    Frame.InputChanged:Connect(function(input)
        if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            dragInput = input
        end
    end)
    
    uis.InputChanged:Connect(function(input)
        if (input == dragInput and dragToggle) then
            updateInput(input)
        end
    end)
end

local bind = Enum.KeyCode.RightControl

function library:SetBind(new)
    bind = new 
end

function library:Destroy()
    ScreenGui:Destroy()
end

function library:NewWindow(titleText, hubText)
    local MainWindow = Instance.new("ImageLabel")
    local Mouse = game.Players.LocalPlayer:GetMouse()
    
    -- Circle Effect Function
    local function CircleClick(Button, X, Y)
        coroutine.resume(coroutine.create(function()
            Button.ClipsDescendants = true
            local Circle = Instance.new("ImageLabel")
            Circle.Name = "Circle"
            Circle.Parent = Button
            Circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            Circle.BackgroundTransparency = 1
            Circle.ZIndex = 10
            Circle.Image = "http://www.roblox.com/asset/?id=6031625146"
            Circle.ImageColor3 = Color3.fromRGB(255, 255, 255)
            Circle.ImageTransparency = 0.5
            
            local NewX = X - Circle.AbsolutePosition.X
            local NewY = Y - Circle.AbsolutePosition.Y
            Circle.Position = UDim2.new(0, NewX, 0, NewY)
            local Size = 0
            if Button.AbsoluteSize.X > Button.AbsoluteSize.Y then
                Size = Button.AbsoluteSize.X * 1.5
            elseif Button.AbsoluteSize.X < Button.AbsoluteSize.Y then
                Size = Button.AbsoluteSize.Y * 1.5
            elseif Button.AbsoluteSize.X == Button.AbsoluteSize.Y then
                Size = Button.AbsoluteSize.X * 1.5
            end
            
            local Time = 0.5
            tween:Create(Circle,TweenInfo.new(Time,Enum.EasingStyle.Sine),{Size = UDim2.new(0, Size, 0, Size),Position = UDim2.new(0.5, -Size / 2, 0.5, -Size / 2)}):Play()
            for i = 1, 10 do
                Circle.ImageTransparency = Circle.ImageTransparency + 0.05
                wait(Time / 10)
            end
            Circle:Destroy()
        end))
    end

    -- Create UI Elements
    MainWindow.Name = "MainWindow"
    MainWindow.Parent = ScreenGui
    MainWindow.BackgroundColor3 = Color3.fromRGB(39, 39, 39)
    MainWindow.BackgroundTransparency = 1
    MainWindow.ClipsDescendants = true
    MainWindow.Position = UDim2.new(0.5, -220, 0.5, -141)
    MainWindow.Size = UDim2.new(0, 0, 0, 0)
    MainWindow.Image = "rbxassetid://3570695787"
    MainWindow.ImageColor3 = Color3.fromRGB(39, 39, 39)
    MainWindow.ScaleType = Enum.ScaleType.Slice
    MainWindow.SliceCenter = Rect.new(100, 100, 100, 100)
    MainWindow.SliceScale = 0.050

    local PageFoler = Instance.new("Folder")
    PageFoler.Parent = MainWindow
    PageFoler.Name = 'Pages'
    
    tween:Create(MainWindow,TweenInfo.new(0.4,Enum.EasingStyle.Back),{Size = UDim2.new(0, 440, 0, 282)}):Play()
    dragify(MainWindow)

    -- Toggle UI Keybind
    uis.InputBegan:Connect(function(input)
        if input.KeyCode == bind then 
            if library.toggled == false then
                library.toggled = true  
                tween:Create(MainWindow,TweenInfo.new(0.4,Enum.EasingStyle.Back,Enum.EasingDirection.In),{Size = UDim2.new(0, 0, 0, 0)}):Play()
            else 
                library.toggled = false 
                tween:Create(MainWindow,TweenInfo.new(0.4,Enum.EasingStyle.Back),{Size = UDim2.new(0, 440, 0, 282)}):Play()
            end 
        end
    end)

    local SectionTab = Instance.new("Frame")
    SectionTab.Name = "SectionTab"
    SectionTab.Parent = MainWindow
    SectionTab.BackgroundColor3 = Color3.fromRGB(36, 36, 36)
    SectionTab.BackgroundTransparency = 1
    SectionTab.Position = UDim2.new(0.046, 0, 0.142, 0)
    SectionTab.Size = UDim2.new(0, 414, 0, 21)

    local Section_List = Instance.new("UIListLayout")
    Section_List.Parent = SectionTab
    Section_List.FillDirection = Enum.FillDirection.Horizontal
    Section_List.SortOrder = Enum.SortOrder.LayoutOrder
    Section_List.Padding = UDim.new(0, 6)

    -- Header Texts
    local Porn = Instance.new("TextLabel")
    Porn.Name = "Title1"
    Porn.Parent = MainWindow
    Porn.BackgroundTransparency = 1
    Porn.Position = UDim2.new(0.04, 0, 0.03, 0)
    Porn.Size = UDim2.new(0, 43, 0, 21)
    Porn.Font = Enum.Font.ArialBold
    Porn.Text = titleText
    Porn.TextColor3 = Color3.fromRGB(255, 255, 255)
    Porn.TextSize = 16.000
    Porn.TextXAlignment = Enum.TextXAlignment.Left

    local Hub = Instance.new("TextLabel")
    Hub.Name = "Title2"
    Hub.Parent = MainWindow
    Hub.BackgroundColor3 = maincolor
    Hub.Position = UDim2.new(0.04, 0, 0.03, 0) -- Adjusted position logic needed if dynamic
    Hub.AutomaticSize = Enum.AutomaticSize.X
    Hub.Size = UDim2.new(0, 42, 0, 19)
    Hub.Font = Enum.Font.ArialBold
    Hub.Text = "  "..hubText.."  "
    Hub.TextColor3 = Color3.fromRGB(0, 0, 0)
    Hub.TextSize = 16.000
    
    -- Adjust positions based on text size
    local textWidth = game:GetService("TextService"):GetTextSize(titleText, 16, Enum.Font.ArialBold, Vector2.new(999,999)).X
    Hub.Position = UDim2.new(0.04, textWidth + 5, 0.03, 0)

    local UICorner_Hub = Instance.new("UICorner")
    UICorner_Hub.CornerRadius = UDim.new(0.3, 0)
    UICorner_Hub.Parent = Hub

    -- Close Button
    local Close = Instance.new("ImageButton")
    Close.Name = "Close"
    Close.Parent = MainWindow
    Close.BackgroundTransparency = 1
    Close.Position = UDim2.new(0.915, 0, 0.028, 0)
    Close.Size = UDim2.new(0, 21, 0, 21)
    Close.Image = "http://www.roblox.com/asset/?id=6031094678"
    Close.ImageColor3 = maincolor
    Close.MouseButton1Click:Connect(function()
        tween:Create(MainWindow,TweenInfo.new(0.2,Enum.EasingStyle.Back,Enum.EasingDirection.In),{Size = UDim2.new(0,0,0,0)}):Play()
        wait(0.3)
        ScreenGui:Destroy()
    end)

    local firstpage = ''
    local TabHandler = {}

    function TabHandler:NewSection(nam)
        local name = tostring(nam) or tostring(math.random(1,5000))
        local TabFrame = Instance.new("ScrollingFrame")
        local Element_List = Instance.new("UIListLayout")
        local TabName = Instance.new("TextButton")
        local Underline = Instance.new("Frame")
        
        local base = UDim2.new(0.037, 0, 0.269, 0)
        
        TabFrame.Name = name 
        TabFrame.Parent = PageFoler
        TabFrame.Active = true
        TabFrame.BackgroundColor3 = Color3.fromRGB(39, 39, 39)
        TabFrame.BorderSizePixel = 0
        TabFrame.Position = base
        TabFrame.Size = UDim2.new(0, 412, 0, 200)
        TabFrame.ScrollBarThickness = 2
        TabFrame.Visible = false 
        TabFrame.ClipsDescendants = true 

        Element_List.Parent = TabFrame
        Element_List.HorizontalAlignment = Enum.HorizontalAlignment.Center
        Element_List.SortOrder = Enum.SortOrder.LayoutOrder
        Element_List.Padding = UDim.new(0, 3)
        
        Element_List:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            TabFrame.CanvasSize = UDim2.new(0, 0, 0, Element_List.AbsoluteContentSize.Y + 10)
        end)

        TabName.Name = name .. "Tab"
        TabName.Parent = SectionTab
        TabName.BackgroundTransparency = 1
        TabName.Size = UDim2.new(0, 49, 0, 21)
        TabName.Font = Enum.Font.Arial
        TabName.Text = name
        TabName.TextColor3 = Color3.fromRGB(90,90,90)
        TabName.TextSize = 14.000
        TabName.AutomaticSize = Enum.AutomaticSize.X

        Underline.Parent = TabName
        Underline.BackgroundColor3 = maincolor
        Underline.Position = UDim2.new(0, 0, 0.95, 0)
        Underline.Size = UDim2.new(0, 0, 0, 1)
        Underline.BorderSizePixel = 0

        if firstpage == '' then
            firstpage = name
            TabFrame.Visible = true
            TabName.TextColor3 = Color3.fromRGB(255,255,255)
            Underline.Size = UDim2.new(1, 0, 0, 1)
        end

        TabName.MouseButton1Click:Connect(function()
            -- Hide all pages
            for _,v in pairs(PageFoler:GetChildren()) do v.Visible = false end
            -- Reset tabs
            for _,v in pairs(SectionTab:GetChildren()) do
                if v:IsA("TextButton") then
                    tween:Create(v, TweenInfo.new(0.2), {TextColor3 = Color3.fromRGB(90,90,90)}):Play()
                    tween:Create(v:FindFirstChild("Frame"), TweenInfo.new(0.2), {Size = UDim2.new(0,0,0,1)}):Play()
                end
            end
            -- Active this tab
            tween:Create(TabName, TweenInfo.new(0.2), {TextColor3 = Color3.fromRGB(255,255,255)}):Play()
            tween:Create(Underline, TweenInfo.new(0.2), {Size = UDim2.new(1,0,0,1)}):Play()
            
            TabFrame.Visible = true
            -- Animation effect
            TabFrame.Position = base + UDim2.new(0,10,0,0)
            tween:Create(TabFrame, TweenInfo.new(0.2), {Position = base}):Play()
            library.currenttab = name
        end)

        local Element = {}

        function Element:Button(name, callback)
            callback = callback or function() end
            local NewButton = Instance.new("TextButton")
            local btnRound = Instance.new("UICorner")
            local BtnIcon = Instance.new("ImageButton")
            
            NewButton.Name = "Button"
            NewButton.Parent = TabFrame
            NewButton.BackgroundColor3 = Color3.fromRGB(48,48,48)
            NewButton.Size = UDim2.new(0, 404, 0, 25)
            NewButton.AutoButtonColor = false
            NewButton.Font = Enum.Font.Arial
            NewButton.Text = "  " .. name 
            NewButton.TextColor3 = Color3.fromRGB(200,200,200)
            NewButton.TextSize = 14.000
            NewButton.TextXAlignment = Enum.TextXAlignment.Left
            
            btnRound.CornerRadius = UDim.new(0, 4)
            btnRound.Parent = NewButton
            
            BtnIcon.Parent = NewButton
            BtnIcon.BackgroundTransparency = 1
            BtnIcon.Position = UDim2.new(1, -25, 0, 3)
            BtnIcon.Size = UDim2.new(0, 19, 0, 19)
            BtnIcon.Image = "http://www.roblox.com/asset/?id=6031229361"
            BtnIcon.ImageColor3 = Color3.fromRGB(200,200,200)

            NewButton.MouseEnter:Connect(function()
                tween:Create(NewButton,TweenInfo.new(0.2),{BackgroundColor3 = Color3.fromRGB(60,60,60),TextColor3 = Color3.fromRGB(255,255,255)}):Play()
                tween:Create(BtnIcon,TweenInfo.new(0.2),{ImageColor3 = Color3.fromRGB(255,255,255)}):Play()
            end)
            NewButton.MouseLeave:Connect(function()
                tween:Create(NewButton,TweenInfo.new(0.2),{BackgroundColor3 = Color3.fromRGB(48,48,48),TextColor3 = Color3.fromRGB(200,200,200)}):Play()
                tween:Create(BtnIcon,TweenInfo.new(0.2),{ImageColor3 = Color3.fromRGB(200,200,200)}):Play()
            end)
            NewButton.MouseButton1Click:Connect(function()
                CircleClick(NewButton, Mouse.X, Mouse.Y)
                pcall(callback)
            end)
        end

        function Element:Toggle(name, callback)
            callback = callback or function() end
            local tog = false
            local NewToggle = Instance.new("TextButton")
            local ToggleIcon = Instance.new("ImageButton")
            
            NewToggle.Name = "Toggle"
            NewToggle.Parent = TabFrame
            NewToggle.BackgroundTransparency = 1
            NewToggle.Size = UDim2.new(0, 404, 0, 25)
            NewToggle.Font = Enum.Font.Arial
            NewToggle.Text = name
            NewToggle.TextColor3 = Color3.fromRGB(200, 200, 200)
            NewToggle.TextSize = 14.000
            NewToggle.TextXAlignment = Enum.TextXAlignment.Left
            
            ToggleIcon.Parent = NewToggle
            ToggleIcon.BackgroundTransparency = 1
            ToggleIcon.Position = UDim2.new(1, -25, 0, 0)
            ToggleIcon.Size = UDim2.new(0, 25, 0, 25)
            ToggleIcon.Image = "http://www.roblox.com/asset/?id=6031068420" -- Off
            ToggleIcon.ImageColor3 = maincolor
            
            local function UpdateToggle()
                tog = not tog
                if tog then
                    ToggleIcon.Image = "http://www.roblox.com/asset/?id=6031068421" -- On
                else
                    ToggleIcon.Image = "http://www.roblox.com/asset/?id=6031068420" -- Off
                end
                pcall(callback, tog)
            end
            
            NewToggle.MouseButton1Click:Connect(UpdateToggle)
            ToggleIcon.MouseButton1Click:Connect(UpdateToggle)
            
            -- Hover effects
            NewToggle.MouseEnter:Connect(function() tween:Create(NewToggle,TweenInfo.new(0.2),{TextColor3 = Color3.fromRGB(255,255,255)}):Play() end)
            NewToggle.MouseLeave:Connect(function() if not tog then tween:Create(NewToggle,TweenInfo.new(0.2),{TextColor3 = Color3.fromRGB(200,200,200)}):Play() end end)
        end

        function Element:Slider(name, min, max, callback)
            min = min or 0
            max = max or 100
            callback = callback or function() end
            
            local NewSlider = Instance.new("TextLabel")
            local SliderBG = Instance.new("Frame")
            local SliderCorner = Instance.new("UICorner")
            local SlideBtn = Instance.new("ImageButton")
            local ValueLabel = Instance.new("TextLabel")
            
            NewSlider.Parent = TabFrame
            NewSlider.BackgroundTransparency = 1
            NewSlider.Size = UDim2.new(0, 404, 0, 30)
            NewSlider.Font = Enum.Font.Arial
            NewSlider.Text = name
            NewSlider.TextColor3 = Color3.fromRGB(200, 200, 200)
            NewSlider.TextSize = 14.000
            NewSlider.TextXAlignment = Enum.TextXAlignment.Left
            
            SliderBG.Parent = NewSlider
            SliderBG.BackgroundColor3 = Color3.fromRGB(49, 62, 71)
            SliderBG.Position = UDim2.new(0.6, 0, 0.5, -2)
            SliderBG.Size = UDim2.new(0, 150, 0, 4)
            
            SliderCorner.CornerRadius = UDim.new(1,0)
            SliderCorner.Parent = SliderBG
            
            SlideBtn.Parent = SliderBG
            SlideBtn.BackgroundTransparency = 1
            SlideBtn.Position = UDim2.new(0, 0, 0.5, -9)
            SlideBtn.Size = UDim2.new(0, 18, 0, 18)
            SlideBtn.Image = "http://www.roblox.com/asset/?id=6031625146"
            SlideBtn.ImageColor3 = maincolor
            
            ValueLabel.Parent = NewSlider
            ValueLabel.BackgroundTransparency = 1
            ValueLabel.Position = UDim2.new(1, -50, 0, 0)
            ValueLabel.Size = UDim2.new(0, 50, 1, 0)
            ValueLabel.Font = Enum.Font.Arial
            ValueLabel.Text = tostring(min) .. "/" .. tostring(max)
            ValueLabel.TextColor3 = Color3.fromRGB(200,200,200)
            ValueLabel.TextSize = 12
            
            local dragging = false
            
            SlideBtn.MouseButton1Down:Connect(function()
                dragging = true
            end)
            
            uis.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then
                    dragging = false
                end
            end)
            
            uis.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                    local mouseLoc = uis:GetMouseLocation()
                    local relativePos = mouseLoc.X - SliderBG.AbsolutePosition.X
                    local percentage = math.clamp(relativePos / SliderBG.AbsoluteSize.X, 0, 1)
                    
                    SlideBtn.Position = UDim2.new(percentage, -9, 0.5, -9)
                    local value = math.floor((percentage * (max - min)) + min)
                    ValueLabel.Text = tostring(value) .. "/" .. tostring(max)
                    pcall(callback, value)
                end
            end)
        end
        
        function Element:Box(name, callback)
            callback = callback or function() end
            local NewBox = Instance.new("TextButton")
            local InputBox = Instance.new("TextBox")
            local Underline = Instance.new("Frame")
            
            NewBox.Parent = TabFrame
            NewBox.BackgroundTransparency = 1
            NewBox.Size = UDim2.new(0, 404, 0, 30)
            NewBox.Text = name
            NewBox.Font = Enum.Font.Arial
            NewBox.TextColor3 = Color3.fromRGB(200,200,200)
            NewBox.TextSize = 14
            NewBox.TextXAlignment = Enum.TextXAlignment.Left
            
            InputBox.Parent = NewBox
            InputBox.BackgroundColor3 = Color3.fromRGB(54,54,54)
            InputBox.BorderSizePixel = 0
            InputBox.Position = UDim2.new(0.6, 0, 0.15, 0)
            InputBox.Size = UDim2.new(0, 150, 0, 20)
            InputBox.Font = Enum.Font.Arial
            InputBox.Text = ""
            InputBox.PlaceholderText = "Type here..."
            InputBox.TextColor3 = Color3.fromRGB(255,255,255)
            InputBox.TextSize = 14
            
            Underline.Parent = InputBox
            Underline.BackgroundColor3 = maincolor
            Underline.Position = UDim2.new(0,0,1,0)
            Underline.Size = UDim2.new(0,0,0,1)
            
            InputBox.Focused:Connect(function()
                tween:Create(Underline, TweenInfo.new(0.2), {Size = UDim2.new(1,0,0,1)}):Play()
            end)
            
            InputBox.FocusLost:Connect(function()
                tween:Create(Underline, TweenInfo.new(0.2), {Size = UDim2.new(0,0,0,1)}):Play()
                pcall(callback, InputBox.Text)
            end)
        end

        function Element:Label(text)
            local Label = Instance.new("TextLabel")
            Label.Parent = TabFrame
            Label.BackgroundTransparency = 1
            Label.Size = UDim2.new(0, 404, 0, 20)
            Label.Font = Enum.Font.SourceSansBold
            Label.Text = text
            Label.TextColor3 = Color3.fromRGB(255, 255, 255)
            Label.TextSize = 16.000
        end

        return Element
    end

    return TabHandler
end

return library
